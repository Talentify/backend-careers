FROM  php:7.3-fpm as php

RUN apt-get update && apt-get install -y libpng-dev libxml2-dev libzip-dev unzip\
    && apt-get install -y libcurl4-openssl-dev pkg-config libssl-dev

RUN pecl install mongodb

RUN curl -sS https://getcomposer.org/installer | php && chmod +x composer.phar && mv composer.phar /usr/local/bin/composer
RUN docker-php-ext-install bcmath sockets calendar gd xml gettext mysqli pcntl soap zip
RUN docker-php-ext-enable mongodb

WORKDIR /data/backend-careers/
COPY . /data/backend-careers/

RUN composer install -o

COPY ./.docker/php-fpm/php.ini /usr/local/etc/php/php.ini
COPY ./.docker/php-fpm/www.conf /usr/local/etc/php-fpm.d/www.conf
COPY ./.docker/php-fpm/php-fpm.conf /usr/local/etc/php-fpm.conf

FROM php as apis

EXPOSE 9000
